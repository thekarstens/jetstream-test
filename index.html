<!DOCTYPE html>
<html>
<head>
    <title>Leaflet-Velocity Wind Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <!-- Leaflet-Velocity CSS and JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/danwild/leaflet-velocity/dist/leaflet-velocity.css" />
    <script src="https://cdn.jsdelivr.net/gh/danwild/leaflet-velocity/dist/leaflet-velocity.js"></script>

    <style>
        #mapid { height: 100vh; width: 100%; }
    </style>
</head>
<body>
    <div id="mapid"></div>

    <script>
        // Initialize the map
        var map = L.map('mapid').setView([40, -97], 4); // Center of North America, zoom level 4

        // Add a base tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Placeholder for velocityLayer, will be initialized after data load
        var velocityLayer = null;

        // Function to load and add the GeoJSON wind data
        function addWindLayer(data) {
            // Remove existing layer if any
            if (velocityLayer) {
                map.removeLayer(velocityLayer);
            }

            // Initialize and add the Leaflet-Velocity layer
            velocityLayer = L.velocityLayer({
                displayValues: true,
                displayOptions: {
                    velocityType: 'Global Wind',
                    position: 'bottomleft',
                    emptyString: 'No wind data',
                    angleConvention: 'bearingCW',
                    speedUnit: 'm/s'
                },
                data: data,
                // Customize particle appearance
                maxVelocity: 20, // Adjust this based on your data's max wind speed
                particleMultiplier: 1 / 50, // Adjust for particle density
                lineWidth: 2, // Adjust for particle line thickness
                frameRate: 15, // Adjust for animation smoothness
                colorScale: ["rgb(36,104, 180)", "rgb(60,157, 194)", "rgb(128,205,189)", "rgb(153,215,193)", "rgb(186,217,179)", "rgb(217,238,189)", "rgb(250,246,197)", "rgb(255,232,185)", "rgb(255,199,141)", "rgb(255,161,101)", "rgb(255,123,71)", "rgb(255,70,45)", "rgb(255,0,24)", "rgb(180,0,35)"]
            });
            
            velocityLayer.addTo(map);
        }

        // Load your GeoJSON data
        fetch('./jetstream_northern_hemisphere_250mb_20180414_18Z.json') // Make sure this path is correct
            .then(response => response.json())
            .then(data => {
                console.log('GeoJSON data loaded:', data);
                addWindLayer(data);
            })
            .catch(error => console.error('Error loading GeoJSON:', error));

    </script>
</body>
</html>